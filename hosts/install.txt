mkfs.btrfs -L <label> /dev/vda1
mkdir -p /mnt
mount /dev/vda1 /mnt
btrfs subvolume create /mnt/root
btrfs subvolume create /mnt/nix
btrfs subvolume create /mnt/boot
btrfs subvolume create /mnt/swap
btrfs subvolume create /mnt/persist
umount /mnt
ln -s /dev/vda1 /dev/disk/by-label/<label>
mount -o compress=zstd,subvol=root /dev/vda1 /mnt
mkdir /mnt/{nix,boot,swap,persist}
mount -o subvol=boot /dev/vda1 /mnt/boot
mount -o compress=zstd,noatime,subvol=nix /dev/vda1 /mnt/nix
mount -o compress=zstd,subvol=persist /dev/vda1 /mnt/persist
mount -o noatime,subvol=swap /dev/vda1 /mnt/swap
nixos-generate-config --root /mnt
